/*!
 * xq-html5sortable v1.0.2 (https://xqkeji.cn/)
 * Author xqkeji.cn
 * LICENSE MIT
 * Copyright 2023 xqkeji.cn
 */
 (function(){"use strict";function c(e,t,n){if(n===void 0){return e&&e.h5s&&e.h5s.data&&e.h5s.data[t]}else{e.h5s=e.h5s||{};e.h5s.data=e.h5s.data||{};e.h5s.data[t]=n}}function t(e){if(e.h5s){delete e.h5s.data}}const h=(e,t)=>{if(!(e instanceof NodeList||e instanceof HTMLCollection||e instanceof Array)){throw new Error("You must provide a nodeList/HTMLCollection/Array of elements to be filtered.")}if(typeof t!=="string"){return Array.from(e)}return Array.from(e).filter(e=>e.nodeType===1&&e.matches(t))};const v=new Map;class W{constructor(){this._config=new Map;this._placeholder=void 0;this._data=new Map}set config(e){if(typeof e!=="object"){throw new Error("You must provide a valid configuration object to the config setter.")}const t=Object.assign({},e);this._config=new Map(Object.entries(t))}get config(){const n={};this._config.forEach((e,t)=>{n[t]=e});return n}setConfig(e,t){if(!this._config.has(e)){throw new Error(`Trying to set invalid configuration item: ${e}`)}this._config.set(e,t)}getConfig(e){if(!this._config.has(e)){throw new Error(`Invalid configuration item requested: ${e}`)}return this._config.get(e)}get placeholder(){return this._placeholder}set placeholder(e){if(!(e instanceof HTMLElement)&&e!==null){throw new Error("A placeholder must be an html element or null.")}this._placeholder=e}setData(e,t){if(typeof e!=="string"){throw new Error("The key must be a string.")}this._data.set(e,t)}getData(e){if(typeof e!=="string"){throw new Error("The key must be a string.")}return this._data.get(e)}deleteData(e){if(typeof e!=="string"){throw new Error("The key must be a string.")}return this._data.delete(e)}}const E=e=>{if(!(e instanceof HTMLElement)){throw new Error("Please provide a sortable to the store function.")}if(!v.has(e)){v.set(e,new W)}return v.get(e)};function a(t,n,r){if(t instanceof Array){for(let e=0;e<t.length;++e){a(t[e],n,r)}return}t.addEventListener(n,r);E(t).setData(`event${n}`,r)}function o(t,n){if(t instanceof Array){for(let e=0;e<t.length;++e){o(t[e],n)}return}t.removeEventListener(n,E(t).getData(`event${n}`));E(t).deleteData(`event${n}`)}function s(t,n,r){if(t instanceof Array){for(let e=0;e<t.length;++e){s(t[e],n,r)}return}t.setAttribute(n,r)}function r(t,n){if(t instanceof Array){for(let e=0;e<t.length;++e){r(t[e],n)}return}t.removeAttribute(n)}const w=e=>{if(!e.parentElement||e.getClientRects().length===0){throw new Error("target element must be part of the dom")}const t=e.getClientRects()[0];return{left:t.left+window.pageXOffset,right:t.right+window.pageXOffset,top:t.top+window.pageYOffset,bottom:t.bottom+window.pageYOffset}};const N=(t,n=0)=>{let r;return(...e)=>{clearTimeout(r);r=setTimeout(()=>{t(...e)},n)}};const y=(e,t)=>{if(!(e instanceof HTMLElement)||!(t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array)){throw new Error("You must provide an element and a list of elements.")}return Array.from(t).indexOf(e)};const d=e=>{if(!(e instanceof HTMLElement)){throw new Error("Element is not a node element.")}return e.parentNode!==null};const n=(e,t,n)=>{if(!(e instanceof HTMLElement)||!(e.parentElement instanceof HTMLElement)){throw new Error("target and element must be a node")}e.parentElement.insertBefore(t,n==="before"?e:e.nextElementSibling)};const F=(e,t)=>n(e,t,"before");const q=(e,t)=>n(e,t,"after");const R=(t,n=(e,t)=>e,e=e=>e)=>{if(!(t instanceof HTMLElement)||!t.isSortable===true){throw new Error("You need to provide a sortableContainer to be serialized.")}if(typeof n!=="function"||typeof e!=="function"){throw new Error("You need to provide a valid serializer for items and the container.")}const r=c(t,"opts");const o=r.items;const i=h(t.children,o);const a=i.map(e=>{return{parent:t,node:e,html:e.outerHTML,index:y(e,i)}});const s={node:t,itemCount:a.length};return{container:e(s),items:a.map(e=>n(e,t))}};const X=(e,t,n="sortable-placeholder")=>{if(!(e instanceof HTMLElement)){throw new Error("You must provide a valid element as a sortable.")}if(!(t instanceof HTMLElement)&&t!==void 0){throw new Error("You must provide a valid element as a placeholder or set ot to undefined.")}if(t===void 0){if(["UL","OL"].includes(e.tagName)){t=document.createElement("li")}else if(["TABLE","TBODY"].includes(e.tagName)){t=document.createElement("tr");t.innerHTML='<td colspan="100"></td>'}else{t=document.createElement("div")}}if(typeof n==="string"){t.classList.add(...n.split(" "))}return t};const b=e=>{if(!(e instanceof HTMLElement)){throw new Error("You must provide a valid dom element")}const n=window.getComputedStyle(e);if(n.getPropertyValue("box-sizing")==="border-box"){return parseInt(n.getPropertyValue("height"),10)}return["height","padding-top","padding-bottom"].map(e=>{const t=parseInt(n.getPropertyValue(e),10);return isNaN(t)?0:t}).reduce((e,t)=>e+t)};const T=e=>{if(!(e instanceof HTMLElement)){throw new Error("You must provide a valid dom element")}const n=window.getComputedStyle(e);return["width","padding-left","padding-right"].map(e=>{const t=parseInt(n.getPropertyValue(e),10);return isNaN(t)?0:t}).reduce((e,t)=>e+t)};const i=(e,t)=>{if(!(e instanceof Array)){throw new Error("You must provide a Array of HTMLElements to be filtered.")}if(typeof t!=="string"){return e}return e.filter(e=>{return e.querySelector(t)instanceof HTMLElement||e.shadowRoot&&e.shadowRoot.querySelector(t)instanceof HTMLElement}).map(e=>{return e.querySelector(t)||e.shadowRoot&&e.shadowRoot.querySelector(t)})};const f=e=>{return e.composedPath&&e.composedPath()[0]||e.target};const j=(e,t,n)=>{return{element:e,posX:n.pageX-t.left,posY:n.pageY-t.top}};const B=(e,t,n)=>{if(!(e instanceof Event)){throw new Error("setDragImage requires a DragEvent as the first argument.")}if(!(t instanceof HTMLElement)){throw new Error("setDragImage requires the dragged element as the second argument.")}if(!n){n=j}if(e.dataTransfer&&e.dataTransfer.setDragImage){const r=w(t);const o=n(t,r,e);if(!(o.element instanceof HTMLElement)||typeof o.posX!=="number"||typeof o.posY!=="number"){throw new Error("The customDragImage function you provided must return and object with the properties element[string], posX[integer], posY[integer].")}e.dataTransfer.effectAllowed="copyMove";e.dataTransfer.setData("text/plain",f(e).id);e.dataTransfer.setDragImage(o.element,o.posX,o.posY)}};const u=(e,t)=>{if(e.isSortable===true){const n=E(e).getConfig("acceptFrom");if(n!==null&&n!==false&&typeof n!=="string"){throw new Error('HTML5Sortable: Wrong argument, "acceptFrom" must be "null", "false", or a valid selector string.')}if(n!==null){return n!==false&&n.split(",").filter(function(e){return e.length>0&&t.matches(e)}).length>0}if(e===t){return true}if(E(e).getConfig("connectWith")!==void 0&&E(e).getConfig("connectWith")!==null){return E(e).getConfig("connectWith")===E(t).getConfig("connectWith")}}return false};const $={items:null,connectWith:null,disableIEFix:null,acceptFrom:null,copy:false,placeholder:null,placeholderClass:"sortable-placeholder",draggingClass:"sortable-dragging",hoverClass:false,dropTargetContainerClass:false,debounce:0,throttleTime:100,maxItems:0,itemSerializer:void 0,containerSerializer:void 0,customDragImage:null,orientation:"vertical"};function U(n,r=250){if(typeof n!=="function"){throw new Error("You must provide a function as the first argument for throttle.")}if(typeof r!=="number"){throw new Error("You must provide a number as the second argument for throttle.")}let o=null;return(...e)=>{const t=Date.now();if(o===null||t-o>=r){o=t;n.apply(this,e)}}}const l=(e,t)=>{if(typeof E(e).getConfig("hoverClass")==="string"){const n=E(e).getConfig("hoverClass").split(" ");if(t===true){a(e,"mousemove",U(t=>{if(t.buttons===0){h(e.children,E(e).getConfig("items")).forEach(e=>{if(e===t.target||e.contains(t.target)){e.classList.add(...n)}else{e.classList.remove(...n)}})}},E(e).getConfig("throttleTime")));a(e,"mouseleave",()=>{h(e.children,E(e).getConfig("items")).forEach(e=>{e.classList.remove(...n)})})}else{o(e,"mousemove");o(e,"mouseleave")}}};let C;let L;let x;let p;let m;let D;let M;let I;let H;const g=function(e){o(e,"dragstart");o(e,"dragend");o(e,"dragover");o(e,"dragenter");o(e,"drop");o(e,"mouseenter");o(e,"mouseleave")};const A=function(e,t){if(e){o(e,"dragleave")}if(t&&t!==e){o(t,"dragleave")}};const k=function(e,t){let n=e;if(E(t).getConfig("copy")===true){n=e.cloneNode(true);s(n,"aria-copied","true");e.parentElement.appendChild(n);n.style.display="none";n.oldDisplay=e.style.display}return n};const S=function(e){t(e);r(e,"aria-dropeffect")};const Y=function(e){r(e,"aria-grabbed");r(e,"aria-copied");r(e,"draggable");r(e,"role")};function _(e,t){if(t.composedPath){return t.composedPath().find(e=>e.isSortable)}while(e.isSortable!==true){e=e.parentElement}return e}function O(e,t){const n=c(e,"opts");const r=h(e.children,n.items);const o=r.filter(function(e){return e.contains(t)||e.shadowRoot&&e.shadowRoot.contains(t)});return o.length>0?o[0]:t}const V=function(e){const t=c(e,"opts")||{};const n=h(e.children,t.items);const r=i(n,t.handle);l(e,false);o(e,"dragover");o(e,"dragenter");o(e,"dragstart");o(e,"dragend");o(e,"drop");S(e);o(r,"mousedown");g(n);Y(n);A(p,I);e.isSortable=false};const P=function(e){const t=c(e,"opts");const n=h(e.children,t.items);const r=i(n,t.handle);s(e,"aria-dropeffect","move");c(e,"_disabled","false");s(r,"draggable","true");l(e,true);if(t.disableIEFix===false){const o=(document||window.document).createElement("span");if(typeof o.dragDrop==="function"){a(r,"mousedown",function(){if(n.indexOf(this)!==-1){this.dragDrop()}else{let e=this.parentElement;while(n.indexOf(e)===-1){e=e.parentElement}e.dragDrop()}})}}};const G=function(e){const t=c(e,"opts");const n=h(e.children,t.items);const r=i(n,t.handle);s(e,"aria-dropeffect","none");c(e,"_disabled","true");s(r,"draggable","false");o(r,"mousedown");l(e,false)};const J=function(e){const t=c(e,"opts");const n=h(e.children,t.items);const r=i(n,t.handle);c(e,"_disabled","false");g(n);A(p,I);o(r,"mousedown");o(e,"dragover");o(e,"dragenter");o(e,"drop")};function z(e,g){const i=String(g);g=g||{};if(typeof e==="string"){e=document.querySelectorAll(e)}if(e instanceof HTMLElement){e=[e]}e=Array.prototype.slice.call(e);if(/serialize/.test(i)){return e.map(e=>{const t=c(e,"opts");return R(e,t.itemSerializer,t.containerSerializer)})}e.forEach(function(l){if(/enable|disable|destroy/.test(i)){return z[i](l)}["connectWith","disableIEFix"].forEach(e=>{if(Object.prototype.hasOwnProperty.call(g,e)&&g[e]!==null){console.warn(`HTML5Sortable: You are using the deprecated configuration "${e}". This will be removed in an upcoming version, make sure to migrate to the new options when updating.`)}});g=Object.assign({},$,E(l).config,g);E(l).config=g;c(l,"opts",g);l.isSortable=true;J(l);const e=h(l.children,g.items);let t;if(g.placeholder!==null&&g.placeholder!==void 0){const r=document.createElement(l.tagName);if(g.placeholder instanceof HTMLElement){r.appendChild(g.placeholder)}else{r.innerHTML=g.placeholder}t=r.children[0]}E(l).placeholder=X(l,t,g.placeholderClass);c(l,"items",g.items);if(g.acceptFrom){c(l,"acceptFrom",g.acceptFrom)}else if(g.connectWith){c(l,"connectWith",g.connectWith)}P(l);s(e,"role","option");s(e,"aria-grabbed","false");a(l,"dragstart",function(e){const t=f(e);if(t.isSortable===true){return}e.stopImmediatePropagation();if(g.handle&&!t.matches(g.handle)||t.getAttribute("draggable")==="false"){return}const n=_(t,e);const r=O(n,t);M=h(n.children,g.items);m=M.indexOf(r);D=y(r,n.children);p=n;B(e,r,g.customDragImage);L=b(r);x=T(r);r.classList.add(g.draggingClass);C=k(r,n);s(C,"aria-grabbed","true");n.dispatchEvent(new CustomEvent("sortstart",{detail:{origin:{elementIndex:D,index:m,container:p},item:C,originalTarget:t,dragEvent:e}}))});a(l,"dragenter",e=>{const n=f(e);const r=_(n,e);if(r&&r!==I){H=h(r.children,c(r,"items")).filter(e=>e!==E(l).placeholder);if(g.dropTargetContainerClass){r.classList.add(g.dropTargetContainerClass)}r.dispatchEvent(new CustomEvent("sortenter",{detail:{origin:{elementIndex:D,index:m,container:p},destination:{container:r,itemsBeforeUpdate:H},item:C,originalTarget:n}}));a(r,"dragleave",function(e){const t=e.relatedTarget||e.fromElement;if(!e.currentTarget.contains(t)){if(g.dropTargetContainerClass){r.classList.remove(g.dropTargetContainerClass)}r.dispatchEvent(new CustomEvent("sortleave",{detail:{origin:{elementIndex:D,index:m,container:r},item:C,originalTarget:n}}))}})}I=r});a(l,"dragend",function(e){if(!C){return}C.classList.remove(g.draggingClass);s(C,"aria-grabbed","false");if(C.getAttribute("aria-copied")==="true"&&c(C,"dropped")!=="true"){C.remove()}if(C.oldDisplay!==void 0){C.style.display=C.oldDisplay;delete C.oldDisplay}const t=Array.from(v.values()).map(e=>e.placeholder).filter(e=>e instanceof HTMLElement).filter(d)[0];if(t){t.remove()}l.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:D,index:m,container:p},item:C,dragEvent:e}}));I=null;C=null;L=null;x=null});a(l,"drop",function(e){if(!u(l,C.parentElement)){return}e.preventDefault();e.stopPropagation();c(C,"dropped","true");const t=Array.from(v.values()).map(e=>{return e.placeholder}).filter(e=>e instanceof HTMLElement).filter(d)[0];if(t){t.replaceWith(C);if(C.oldDisplay!==void 0){C.style.display=C.oldDisplay;delete C.oldDisplay}}else{c(C,"dropped","false");return}const n=E(l).placeholder;const r=h(p.children,g.items).filter(e=>e!==n);const o=this.isSortable===true?this:this.parentElement;const i=h(o.children,c(o,"items")).filter(e=>e!==n);const a=y(C,Array.from(C.parentElement.children).filter(e=>e!==n));const s=y(C,i);if(g.dropTargetContainerClass){o.classList.remove(g.dropTargetContainerClass)}l.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:D,index:m,container:p},item:C,destination:{index:s,elementIndex:a,container:o,itemsBeforeUpdate:H,items:i},dragEvent:e}}));if(D!==a||p!==o){l.dispatchEvent(new CustomEvent("sortupdate",{detail:{origin:{elementIndex:D,index:m,container:p,itemsBeforeUpdate:M,items:r},destination:{index:s,elementIndex:a,container:o,itemsBeforeUpdate:H,items:i},item:C,dragEvent:e}}))}});const o=N((n,e,r,o)=>{if(!C){return}if(g.forcePlaceholderSize){E(n).placeholder.style.height=L+"px";E(n).placeholder.style.width=x+"px"}if(Array.from(n.children).indexOf(e)>-1){const i=b(e);const a=T(e);const s=y(E(n).placeholder,e.parentElement.children);const l=y(e,e.parentElement.children);if(i>L||a>x){const c=i-L;const d=a-x;const f=w(e).top;const u=w(e).left;if(s<l&&(g.orientation==="vertical"&&o<f||g.orientation==="horizontal"&&r<u)){return}if(s>l&&(g.orientation==="vertical"&&o>f+i-c||g.orientation==="horizontal"&&r>u+a-d)){return}}if(C.oldDisplay===void 0){C.oldDisplay=C.style.display}if(C.style.display!=="none"){C.style.display="none"}let t=false;try{const p=w(e).top+e.offsetHeight/2;const m=w(e).left+e.offsetWidth/2;t=g.orientation==="vertical"&&o>=p||g.orientation==="horizontal"&&r>=m}catch(e){t=s<l}if(t){q(e,E(n).placeholder)}else{F(e,E(n).placeholder)}Array.from(v.values()).filter(e=>e.placeholder!==void 0).forEach(e=>{if(e.placeholder!==E(n).placeholder){e.placeholder.remove()}})}else{const t=Array.from(v.values()).filter(e=>e.placeholder!==void 0).map(e=>{return e.placeholder});if(t.indexOf(e)===-1&&n===e&&!h(e.children,g.items).length){t.forEach(e=>e.remove());e.appendChild(E(n).placeholder)}}},g.debounce);const n=function(e){let t=e.target;const n=t.isSortable===true?t:_(t,e);t=O(n,t);if(!C||!u(n,C.parentElement)||c(n,"_disabled")==="true"){return}const r=c(n,"opts");if(parseInt(r.maxItems)&&h(n.children,c(n,"items")).length>=parseInt(r.maxItems)&&C.parentElement!==n){return}e.preventDefault();e.stopPropagation();e.dataTransfer.dropEffect=E(n).getConfig("copy")===true?"copy":"move";o(n,t,e.pageX,e.pageY)};a(e.concat(l),"dragover",n);a(e.concat(l),"dragenter",n)});return e}z.destroy=function(e){V(e)};z.enable=function(e){P(e)};z.disable=function(e){G(e)};z.__testing={data:c,removeItemEvents:g,removeItemData:Y,removeSortableData:S,removeContainerEvents:A};module.exports=z})();